{% extends "base.html" %}
{% load static %}
{% load inia_extras %}

{% block content %}
<h2><strong>SEARCH</strong></h2>
    <br />
    <form action="{% url 'inia:search' %}" method="get" />
        <input type="hidden" name="output" value="html" />
        <input type="text" name="gene" value="{{ old_search }}" placeholder="Search For Gene..." required /><br/>
    Filters:
    <br/>
    <button type="submit">Search <i class="fa fa-search"></i></button> <br />
    </form>
    {% if errors %}
        <div class="search-error">
            <ul>
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
            </ul>
        </div>
    {% endif %}
    {% if not genes %}
        Enter some values to search IT-GED.
        {% else %}
        Dataset Summary | View Gene Network | Overrepresentation Analysis | <a href="{{ urlencode }}">Download CSV</a>
        <div class="pagination">
            <span class="step-links">
        {% if genes.has_previous %}
            <a href="?{{ urlencode }}&page=1">&laquo; first</a>
            <a href="?{{ urlencode }}&page={{ genes.previous_page_number }}">previous</a>
        {% endif %}

        <span class="current">
            <br />Page {{ genes.number }} of {{ genes.paginator.num_pages }}.
        </span>

        {% if genes.has_next %}
            <a href="?{{ urlencode }}&page={{ genes.next_page_number }}">next</a>
            <a href="?{{ urlencode }}&page={{ genes.paginator.num_pages }}">last &raquo;</a>
        {% endif %}
        <h3>Total results:{{ total_results }}</h3>
    </span>
</div>

<div class="table-responsive">
        <table class="table search-table">
        <tr>
        <td>Gene Symbol</td>
        <td>Gene Name</td>
        <td>Aliases</td>
        <td>Gene Expression Platform</td>
        <td>Probe/Gene ID</td>
        <td>Species</td>
        <td>Ethanol/Treatment</td>
        <td>Brain region/Cell type</td>
        <td>P-value</td>
        <td>Direction of Change</td>
        <td>Est FDR</td>
        <td>Dataset</td>
        <td>Reference</td>
        </tr>
        {% for gene in genes %}
            <tr>
            <td> {% if not gene.gene_symbol %} - {% else %}{{gene.gene_symbol}}{% endif %}</td>
            <td>{{gene.gene_name}}</td>
            <td>{% if not gene.genealiases_set.all %} - {% else %}
                {%  for alias in gene.genealiases_set.all %}
                    {{ alias.symbol }},
                    {% endfor %}
            {% endif %}
            </td>
            <td>{{ gene.dataset.microarray }}</td>
            <td>{{ gene.uniqueID }}</td>
            <td>{{ gene.dataset.species }}</td>
            <td>{{ gene.dataset.treatment }}</td>
            <td>{{ gene.dataset.brain_region.name}}</td>
            <td>{{ gene.p_value }}</td>
            <td>
                {% direction_tooltip gene.direction %}
            </td>
            <td>{{ gene.fdr }}</td>
            <td>
                <div rel='tooltip' data-original-title='<strong>{{ gene.dataset.name }}</strong><br /><strong>Alcohol on board</strong>: {{gene.dataset.alcohol|yesno:"YES,NO"}}<br/><strong>INIA Model</strong>: {{gene.dataset.model}}<br/><strong>Phenotype</strong>: {{ gene.dataset.phenotype }}<br/><strong>Paradigm</strong>: {{ gene.dataset.paradigm }}<br/><strong>Brain Region</strong>: {{ gene.dataset.brain_region.name }} ({{gene.dataset.brain_region.abbreviation }})<br/>'>
                <a href="{% url 'inia:search' %}?dataset={{ gene.dataset.name }}&output=html" />
                    {{ gene.dataset.name }}
                </a>
                </div>

            </td>
                <td>
                    <div rel='tooltip' data-original-title='<strong>{{ gene.dataset.publication.htmlid }}</strong><br /><strong>Title</strong>: {{ gene.dataset.publication.title }}<br/><strong>Author</strong>: {{gene.dataset.publication.get_primary_author}} et al<br/><strong>Journal</strong>: {{ gene.dataset.publication.journal }}<br/><strong>Date</strong>: {{ gene.dataset.publication.get_submit_day }}<br/>'>
                        <a href="{% url 'inia:datasets_home' %}" />
                        {{ gene.dataset.publication.get_short_name }}
                        </a>
                    </div>


                </td>
            </tr>
        {% endfor %}
        </table>
</div>
    {% endif %}
<br /><br/>
{% include '_wildcard_box.html' %}
{%  endblock %}

{% block extrajs %}
<script type="text/javascript">
    $("[rel=tooltip]").tooltip({html:true});
</script>
{% endblock %}